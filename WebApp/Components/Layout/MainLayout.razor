@inherits LayoutComponentBase
@implements IDisposable
@using Microsoft.AspNetCore.Components.Routing

<PageTitle>–ê—Ä—Ö–†–µ–µ—Å—Ç—Ä</PageTitle>

<div class="page">
    <header class="top-bar">
        <div class="container nav-inner">
            <div class="nav-header">
                <div class="brand">
                    <img class="brand-logo" height="50" width="100" src="Images/Logo/logo.png" alt="–õ–æ–≥–æ—Ç–∏–ø –ê—Ä—Ö–†–µ–µ—Å—Ç—Ä" />
                </div>
                <button
                    type="button"
                    class="nav-toggle"
                    aria-label="–û—Ç–∫—Ä—ã—Ç—å –º–µ–Ω—é"
                    aria-controls="main-nav"
                    aria-expanded="@isMenuOpen"
                    @onclick="ToggleMenu">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
            <div id="main-nav" class="@NavMenuClass">
                <nav>
                    <NavLink href="/" Match="NavLinkMatch.All" @onclick="CloseMenu">–ö–∞—Ç–∞–ª–æ–≥ –æ–±—ä–µ–∫—Ç–æ–≤</NavLink>
                    <NavLink href="/favorites" Match="NavLinkMatch.Prefix" @onclick="CloseMenu">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</NavLink>
                    <AuthorizeView Roles="admin">
                        <Authorized>
                            <NavLink href="/admin" Match="NavLinkMatch.Prefix" @onclick="CloseMenu">–ö–∞–±–∏–Ω–µ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</NavLink>
                        </Authorized>
                    </AuthorizeView>
                    <AuthorizeView Roles="admin,agent">
                        <Authorized>
                            <NavLink href="/realtor" Match="NavLinkMatch.Prefix" @onclick="CloseMenu">–ö–∞–±–∏–Ω–µ—Ç —Ä–∏–µ–ª—Ç–æ—Ä–∞</NavLink>
                        </Authorized>
                    </AuthorizeView>
                    <AuthorizeView Roles="admin,client">
                        <Authorized>
                            <NavLink href="/client" class="nav-link" Match="NavLinkMatch.Prefix">–ö–∞–±–∏–Ω–µ—Ç –∫–ª–∏–µ–Ω—Ç–∞</NavLink>
                        </Authorized>
                    </AuthorizeView>
                </nav>
                <LoginDisplay />
            </div>
        </div>
    </header>
    <main>
        <div class="container">
            @Body
        </div>
    </main>
</div>

<div id="blazor-error-ui">
    –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. <a href="" class="reload">–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å</a>
    <a class="dismiss">üóô</a>
</div>

@code {
    [Inject]
    private NavigationManager NavigationManager { get; set; } = default!;

    private bool isMenuOpen;

    private string NavMenuClass => isMenuOpen ? "nav-menu open" : "nav-menu";

    protected override void OnInitialized()
    {
        NavigationManager.LocationChanged += OnLocationChanged;
    }

    private void ToggleMenu()
    {
        isMenuOpen = !isMenuOpen;
    }

    private void CloseMenu()
    {
        isMenuOpen = false;
    }

    private void OnLocationChanged(object? sender, LocationChangedEventArgs e)
    {
        isMenuOpen = false;
        _ = InvokeAsync(StateHasChanged);
    }

    public void Dispose()
    {
        NavigationManager.LocationChanged -= OnLocationChanged;
    }
}
